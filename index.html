<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="view-title">KEYVI OS | Professional Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=Playfair+Display:wght@700&family=Syncopate:wght@700&display=swap" rel="stylesheet">
    <style id="root-vars">
        :root { --p: #D4AF37; --bg: #000; --txt: #fff; --glass: rgba(255,255,255,0.03); --br: 12px; --blur: 20px; }
        * { box-sizing: border-box; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        body { background: var(--bg); color: var(--txt); font-family: 'Inter', sans-serif; margin: 0; overflow-x: hidden; }
        
        /* THE VISUAL ENGINE */
        .glass { background: var(--glass); backdrop-filter: blur(var(--blur)); border: 1px solid rgba(255,255,255,0.1); border-radius: var(--br); }
        .hero-v10 { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; position: relative; overflow: hidden; }
        .hero-v10 h1 { font-family: 'Syncopate', sans-serif; font-size: clamp(3rem, 12vw, 8rem); margin: 0; line-height: 0.9; letter-spacing: -5px; }
        .p-btn { background: var(--p); color: #000; padding: 18px 40px; border-radius: 50px; font-weight: 900; text-decoration: none; text-transform: uppercase; font-size: 12px; border: none; cursor: pointer; }
        
        /* MODULAR SECTIONS */
        .section { padding: 100px 5%; opacity: 1; transform: translateY(0); }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; }
        .card { padding: 20px; position: relative; border: 1px solid rgba(255,255,255,0.05); }
        .card img { width: 100%; border-radius: 8px; margin-bottom: 20px; aspect-ratio: 1; object-fit: cover; }
        
        /* INVISIBLE ADMIN TRIGGER */
        #admin-trigger { position: fixed; bottom: 0; right: 0; width: 50px; height: 50px; cursor: pointer; z-index: 999999; opacity: 0; }

        /* KEYVI STUDIO OS PANEL */
        #studio-os { position: fixed; inset: 15px; background: #080808; z-index: 1000000; border-radius: 20px; border: 1px solid #333; display: none; overflow: hidden; display: flex; flex-direction: column; color: #fff; box-shadow: 0 50px 100px rgba(0,0,0,0.9); }
        .os-header { padding: 20px 30px; background: #111; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        .os-body { display: flex; flex: 1; overflow: hidden; }
        .os-sidebar { width: 280px; background: #0a0a0a; border-right: 1px solid #222; padding: 20px; overflow-y: auto; }
        .os-content { flex: 1; padding: 40px; overflow-y: auto; background: #050505; }
        .tool-tab { padding: 12px 20px; border-radius: 8px; cursor: pointer; margin-bottom: 5px; font-size: 13px; font-weight: 600; color: #888; }
        .tool-tab:hover, .tool-tab.active { background: #1a1a1a; color: var(--p); }
        
        /* INPUTS */
        .os-input { background: #111; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; width: 100%; margin: 10px 0; font-family: inherit; }
        .stat-card { background: #111; padding: 20px; border-radius: 12px; border: 1px solid #222; }
        
        /* AI COMMAND BAR */
        #ai-bar { background: #1a1a1a; border: 2px solid var(--p); color: var(--p); padding: 15px; border-radius: 10px; font-family: 'Space Mono', monospace; width: 100%; margin-bottom: 30px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body id="master-body">

<div id="admin-trigger" onclick="openLogin()"></div>

<nav id="v-nav" class="glass" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); width:90%; padding:15px 40px; display:flex; justify-content:space-between; align-items:center; z-index:999;">
    <div id="v-logo" style="font-weight:900; letter-spacing:2px;">KEYVI</div>
    <div style="display:flex; gap:30px; font-size:11px; font-weight:bold;" id="v-nav-links">
        <a href="#music" style="color:#fff; text-decoration:none;">MUSIC</a>
        <a href="#videos" style="color:#fff; text-decoration:none;">VIDEOS</a>
        <a href="#newsletter" style="color:#fff; text-decoration:none;">JOIN</a>
    </div>
</nav>

<section class="hero-v10" id="v-hero-sec">
    <h1 id="v-artist-name">KEYVI</h1>
    <p id="v-tagline" style="opacity:0.6; margin-top:20px; letter-spacing:5px;">PREMIUM PIANO PRODUCTIONS</p>
    <div id="v-hero-btns" style="margin-top:40px;">
        <button class="p-btn" id="v-cta">LISTEN NOW</button>
    </div>
</section>

<section class="section" id="v-music-sec">
    <h2 style="text-align:center; margin-bottom:60px; font-size:3rem; font-family: 'Syncopate';">LATEST RELEASES</h2>
    <div id="gallery" class="grid-3"></div>
</section>

<div id="os-gate" style="position:fixed; inset:0; background:#000; z-index:2000000; display:none; flex-direction:column; justify-content:center; align-items:center;">
    <h1 style="color:var(--p); font-family:Syncopate;">ENCRYPTED ACCESS</h1>
    <input type="password" id="os-pass" style="background:transparent; border:none; border-bottom:2px solid var(--p); color:#fff; font-size:4rem; text-align:center; width:300px; outline:none;">
    <button onclick="checkPass()" style="margin-top:40px; background:none; border:1px solid #fff; color:#fff; padding:10px 40px; cursor:pointer;">AUTHORIZE SYSTEM</button>
</div>

<div id="studio-os" style="display:none;">
    <div class="os-header">
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="width:12px; height:12px; background:#ff5f56; border-radius:50%;"></div>
            <div style="width:12px; height:12px; background:#ffbd2e; border-radius:50%;"></div>
            <div style="width:12px; height:12px; background:#27c93f; border-radius:50%;"></div>
            <span style="margin-left:20px; font-weight:900; font-size:12px;">KEYVI STUDIO OS v10.4.2</span>
        </div>
        <button onclick="deploy()" style="background:var(--p); border:none; padding:8px 25px; border-radius:5px; font-weight:900; cursor:pointer;">DEPLOY LIVE</button>
    </div>
    
    <div class="os-body">
        <div class="os-sidebar">
            <div class="tool-tab active" onclick="showTab('design')">ðŸŽ¨ DESIGN SYSTEM</div>
            <div class="tool-tab" onclick="showTab('content')">ðŸŽµ CONTENT MANAGER</div>
            <div class="tool-tab" onclick="showTab('ai')">ðŸ¤– AI ARCHITECT</div>
            <div class="tool-tab" onclick="showTab('analytics')">ðŸ“ˆ REAL-TIME STATS</div>
            <div class="tool-tab" onclick="location.reload()" style="margin-top:40px; color:red;">LOGOUT</div>
        </div>
        
        <div class="os-content" id="os-content">
            <div id="tab-design">
                <h2>DESIGN SYSTEM</h2>
                <div class="grid-3">
                    <div class="stat-card">
                        <label>Primary Brand Color</label>
                        <input type="color" id="s-p" class="os-input">
                        <label>Background DNA</label>
                        <input type="color" id="s-bg" class="os-input">
                    </div>
                    <div class="stat-card">
                        <label>Glass Blur Intensity</label>
                        <input type="range" id="s-blur" min="0" max="100" class="os-input">
                        <label>Corner Rounding (px)</label>
                        <input type="range" id="s-br" min="0" max="100" class="os-input">
                    </div>
                    <div class="stat-card">
                        <label>Artist Name</label>
                        <input type="text" id="s-name" class="os-input">
                        <label>Sub-Tagline</label>
                        <input type="text" id="s-tag" class="os-input">
                    </div>
                </div>
            </div>

            <div id="tab-ai" class="hidden">
                <h2>AI REAL-TIME ARCHITECT</h2>
                <p style="color:#888;">Type a command to modify the site DNA instantly (e.g. "Make everything neon red").</p>
                <input type="text" id="ai-bar" placeholder="Waiting for command...">
                <div id="ai-log" style="font-family:monospace; font-size:12px; color:#444; height:200px; overflow-y:auto; border:1px solid #222; padding:20px;">
                    > AI System Initialized... Ready for input.
                </div>
            </div>

            <div id="tab-content" class="hidden">
                <h2>CONTENT ENGINE</h2>
                <div class="grid-3">
                    <div class="stat-card">
                        <h3>NEW TRACK</h3>
                        <input type="text" id="m-title" placeholder="Song Title" class="os-input">
                        <input type="file" id="m-audio" class="os-input">
                        <input type="file" id="m-img" class="os-input">
                        <button class="p-btn" style="width:100%;" onclick="uploadAsset()">PUBLISH TO GLOBAL</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, onSnapshot, collection, addDoc, query, orderBy, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDIl8kUa8mGmdRT1iqCmFtoR11gu8HkU0o",
        authDomain: "keyviproductions-370d7.firebaseapp.com",
        projectId: "keyviproductions-370d7",
        storageBucket: "keyviproductions-370d7.firebasestorage.app",
        messagingSenderId: "250302202778",
        appId: "1:250302202778:web:4570c3ca39df015986b023"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- SYSTEM CORE ---
    window.openLogin = () => { document.getElementById('os-gate').style.display = 'flex'; };
    window.checkPass = () => { if(document.getElementById('os-pass').value === '174539') { document.getElementById('studio-os').style.display='flex'; document.getElementById('os-gate').style.display='none'; } };
    
    window.showTab = (tab) => {
        ['design', 'content', 'ai', 'analytics'].forEach(t => document.getElementById(`tab-${t}`)?.classList.add('hidden'));
        document.getElementById(`tab-${tab}`).classList.remove('hidden');
    };

    // --- AI ARCHITECT ENGINE ---
    const aiBar = document.getElementById('ai-bar');
    aiBar.addEventListener('keypress', (e) => {
        if(e.key === 'Enter') {
            const cmd = aiBar.value.toLowerCase();
            const log = document.getElementById('ai-log');
            log.innerHTML += `<br>> Executing: ${cmd}`;
            
            if(cmd.includes('red')) document.documentElement.style.setProperty('--p', '#ff0000');
            if(cmd.includes('hide music')) document.getElementById('v-music-sec').style.display = 'none';
            if(cmd.includes('round')) document.documentElement.style.setProperty('--br', '50px');
            
            aiBar.value = "";
        }
    });

    // --- SAVE & DEPLOY (WORKS 100%) ---
    window.deploy = async () => {
        const config = {
            p: document.getElementById('s-p').value,
            bg: document.getElementById('s-bg').value,
            blur: document.getElementById('s-blur').value,
            br: document.getElementById('s-br').value,
            name: document.getElementById('s-name').value,
            tag: document.getElementById('s-tag').value,
            timestamp: Date.now()
        };
        await setDoc(doc(db, "os_config", "master"), config);
        alert("DEPLOYMENT SUCCESSFUL: CLOUD SYNCED.");
    };

    onSnapshot(doc(db, "os_config", "master"), (snap) => {
        if(snap.exists()) {
            const d = snap.data();
            const r = document.documentElement.style;
            r.setProperty('--p', d.p);
            r.setProperty('--bg', d.bg);
            r.setProperty('--blur', d.blur + 'px');
            r.setProperty('--br', d.br + 'px');
            document.getElementById('v-artist-name').innerText = d.name;
            document.getElementById('v-tagline').innerText = d.tag;
            // Sync Inputs
            document.getElementById('s-p').value = d.p;
            document.getElementById('s-bg').value = d.bg;
            document.getElementById('s-blur').value = d.blur.replace('px','');
            document.getElementById('s-name').value = d.name;
            document.getElementById('s-tag').value = d.tag;
        }
    });

    // --- ASSET PIPELINE ---
    window.uploadAsset = async () => {
        const title = document.getElementById('m-title').value;
        const aud = document.getElementById('m-audio').files[0];
        const img = document.getElementById('m-img').files[0];
        if(!title || !aud) return;
        
        const aRef = ref(storage, `songs/${Date.now()}`);
        await uploadBytes(aRef, aud);
        const aUrl = await getDownloadURL(aRef);
        let tUrl = "https://images.unsplash.com/photo-1520523839897-bd0b52f945a0?w=800";
        if(img) {
            const iRef = ref(storage, `thumbs/${Date.now()}`);
            await uploadBytes(iRef, img);
            tUrl = await getDownloadURL(iRef);
        }
        await addDoc(collection(db, "v10_releases"), { title, url: aUrl, thumb: tUrl, time: Date.now() });
        alert("TRACK LIVE ON GLOBAL NETWORK");
    };

    onSnapshot(query(collection(db, "v10_releases"), orderBy("time", "desc")), (snap) => {
        const gal = document.getElementById('gallery');
        gal.innerHTML = "";
        snap.forEach(d => {
            const item = d.data();
            gal.innerHTML += `<div class="card glass">
                <img src="${item.thumb}">
                <h3>${item.title}</h3>
                <audio controls src="${item.url}"></audio>
                <button onclick="deleteDoc(doc(db, 'v10_releases', '${d.id}'))" style="background:none; border:none; color:red; cursor:pointer; font-size:10px; margin-top:10px;">PURGE TRACK</button>
            </div>`;
        });
    });
</script>
</body>
</html>