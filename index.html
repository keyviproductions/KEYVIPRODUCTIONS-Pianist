<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEYVI PRODUCTIONS | Studio Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700&family=Playfair+Display:ital@1&display=swap" rel="stylesheet">
    <style id="theme-engine">
        :root { --main-gold: #D4AF37; --main-bg: #050505; --text: #fff; }
        body { background: var(--main-bg); color: var(--text); font-family: 'Montserrat', sans-serif; margin: 0; }
        .hero { height: 60vh; display: flex; flex-direction: column; justify-content: center; align-items: center; border-bottom: 2px solid var(--main-gold); }
        nav { padding: 20px; text-align: center; background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; }
        nav a { color: var(--text); margin: 0 15px; text-decoration: none; font-weight: bold; font-size: 11px; letter-spacing: 2px; }
        #gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; padding: 40px; }
        .card { background: #111; border-radius: 10px; border: 1px solid #222; overflow: hidden; position: relative; }
        .thumb { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        audio { width: 90%; margin: 5%; filter: invert(1); }
        
        /* THE COMMAND CENTER */
        #admin-panel { position: fixed; bottom: 0; left:0; width: 100%; height: 55vh; background: #000; border-top: 4px solid var(--main-gold); z-index: 9999; display: none; overflow-y: auto; box-shadow: 0 -20px 50px rgba(0,0,0,0.9); }
        .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; padding: 30px; }
        .section-box { background: #111; padding: 15px; border-radius: 8px; border: 1px solid #333; }
        .section-box h4 { color: var(--main-gold); margin-top: 0; font-size: 11px; letter-spacing: 1px; }
        input, select { width: 100%; padding: 10px; background: #000; color: white; border: 1px solid #444; border-radius: 4px; margin-bottom: 10px; box-sizing: border-box; }
        
        .publish-bar { position: sticky; top: 0; background: var(--main-gold); color: #000; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; z-index: 10; }
        .deploy-btn { background: #000; color: #fff; border: none; padding: 10px 25px; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .deploy-btn:hover { background: #222; }
    </style>
</head>
<body>

<section class="hero" id="hero-bg">
    <h1 id="view-name" style="font-size: 4rem; letter-spacing: 10px; margin: 0;">KEYVI PRODUCTIONS</h1>
    <p id="view-slogan" style="letter-spacing: 5px; opacity: 0.7;">LOADING PORTFOLIO...</p>
</section>

<nav>
    <a href="#gallery">GALLERY</a>
    <a href="#" id="view-yt" target="_blank">YOUTUBE</a>
    <a href="#" id="view-sp" target="_blank">SPOTIFY</a>
</nav>

<main id="gallery"></main>

<footer style="text-align: center; padding: 60px; opacity: 0.1;">
    <button onclick="document.getElementById('login-gate').style.display='flex'">MASTER SETTINGS</button>
</footer>

<div id="login-gate" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); display:none; justify-content:center; align-items:center; z-index:10000;">
    <div style="background:#111; padding:40px; border:2px solid var(--main-gold); text-align:center;">
        <h2 style="color:var(--main-gold)">SECURE ACCESS</h2>
        <input type="password" id="access-key" style="text-align:center; font-size:2rem; width:200px; margin-bottom:20px;">
        <button onclick="unlock()" class="deploy-btn" style="width:100%; background:var(--main-gold); color:#000;">UNLOCK DASHBOARD</button>
    </div>
</div>

<div id="admin-panel">
    <div class="publish-bar">
        <span>STAGING MODE: Changes are local until you publish.</span>
        <button class="deploy-btn" onclick="deployAll()">REPUBLISH INSTANTLY</button>
    </div>

    <div class="admin-grid">
        <div class="section-box">
            <h4>1. BRANDING & TEXT</h4>
            <label style="font-size:9px">ARTIST NAME</label>
            <input type="text" id="edit-name" oninput="stageChange()">
            <label style="font-size:9px">SLOGAN</label>
            <input type="text" id="edit-slogan" oninput="stageChange()">
        </div>

        <div class="section-box">
            <h4>2. THEME & COLORS</h4>
            <label style="font-size:9px">BACKGROUND</label><input type="color" id="edit-bg" oninput="stageChange()">
            <label style="font-size:9px">ACCENT GOLD</label><input type="color" id="edit-gold" oninput="stageChange()">
            <label style="font-size:9px">TYPOGRAPHY</label>
            <select id="edit-font" onchange="stageChange()">
                <option value="'Montserrat'">Modern (Montserrat)</option>
                <option value="'Playfair Display'">Elegant (Playfair)</option>
                <option value="'Courier New'">Studio (Mono)</option>
            </select>
        </div>

        <div class="section-box">
            <h4>3. DISTRIBUTION LINKS</h4>
            <label style="font-size:9px">YOUTUBE URL</label><input type="text" id="edit-yt" oninput="stageChange()">
            <label style="font-size:9px">SPOTIFY URL</label><input type="text" id="edit-sp" oninput="stageChange()">
        </div>

        <div class="section-box">
            <h4>4. DISTRIBUTE NEW AUDIO</h4>
            <input type="text" id="new-track-name" placeholder="Song Title">
            <input type="file" id="new-audio" accept="audio/*">
            <input type="file" id="new-cover" accept="image/*">
            <button onclick="distributeTrack()" style="width:100%; padding:10px; background:#222; color:#fff; border:none; cursor:pointer;">UPLOAD TO SERVER</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, onSnapshot, collection, addDoc, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDIl8kUa8mGmdRT1iqCmFtoR11gu8HkU0o",
        authDomain: "keyviproductions-370d7.firebaseapp.com",
        projectId: "keyviproductions-370d7",
        storageBucket: "keyviproductions-370d7.firebasestorage.app",
        messagingSenderId: "250302202778",
        appId: "1:250302202778:web:4570c3ca39df015986b023"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- 1. LOCAL STAGING LOGIC (No Wait Time) ---
    window.stageChange = () => {
        const bg = document.getElementById('edit-bg').value;
        const gold = document.getElementById('edit-gold').value;
        const font = document.getElementById('edit-font').value;
        
        // Immediate Local Preview
        document.body.style.backgroundColor = bg;
        document.documentElement.style.setProperty('--main-gold', gold);
        document.body.style.fontFamily = font;
        document.getElementById('view-name').innerText = document.getElementById('edit-name').value;
        document.getElementById('view-slogan').innerText = document.getElementById('edit-slogan').value;