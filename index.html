<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KEYVI | Creator Studio</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Syncopate:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --yt-red: #ff0000; --yt-bg: #0f0f0f; --yt-sidebar: #0f0f0f; --yt-card: #1e1e1e; --p: #D4AF37; }
        body { background: var(--yt-bg); color: white; font-family: 'Roboto', sans-serif; margin: 0; }
        
        /* ADMIN INTERFACE */
        #studio-overlay { position: fixed; inset: 0; background: var(--yt-bg); z-index: 999999; display: none; flex-direction: column; }
        .studio-nav { height: 56px; background: #202020; display: flex; align-items: center; padding: 0 24px; border-bottom: 1px solid #333; justify-content: space-between; }
        .studio-body { display: flex; flex: 1; }
        .studio-sidebar { width: 256px; background: var(--yt-sidebar); border-right: 1px solid #333; padding-top: 8px; }
        .studio-content { flex: 1; padding: 40px; overflow-y: auto; background: #161616; }
        
        /* THE "UPLOAD" MODAL (YOUTUBE STYLE) */
        .upload-flow { background: #282828; width: 90%; max-width: 960px; height: 80vh; margin: auto; border-radius: 12px; display: flex; flex-direction: column; box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
        .flow-header { padding: 20px; border-bottom: 1px solid #3e3e3e; display: flex; justify-content: space-between; }
        .flow-body { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; padding: 24px; flex: 1; overflow-y: auto; }
        
        /* INPUT STYLING */
        .yt-input-wrap { border: 1px solid #606060; border-radius: 4px; padding: 8px 12px; margin-bottom: 20px; }
        .yt-input-wrap label { font-size: 12px; color: #aaa; display: block; }
        .yt-input-wrap input, .yt-input-wrap textarea { background: transparent; border: none; color: white; width: 100%; outline: none; font-size: 15px; padding-top: 4px; }
        
        .thumbnail-box { background: #1a1a1a; border: 2px dashed #444; height: 120px; display: flex; align-items: center; justify-content: center; cursor: pointer; text-align: center; font-size: 13px; }
        .preview-pane { background: #000; aspect-ratio: 16/9; border-radius: 4px; position: sticky; top: 0; }
        
        /* FRONTEND RELEASES */
        .yt-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 40px; }
        .yt-card { cursor: pointer; }
        .yt-thumb { width: 100%; aspect-ratio: 16/9; background: #333; border-radius: 12px; object-fit: cover; }
        .yt-info { margin-top: 12px; display: flex; gap: 12px; }
        .yt-avatar { width: 36px; height: 36px; border-radius: 50%; background: var(--p); }
        
        #admin-btn { position: fixed; bottom: 20px; right: 20px; opacity: 0.05; cursor: pointer; z-index: 100; }
    </style>
</head>
<body>

<div id="admin-btn" onclick="openStudio()">ðŸ”‘</div>

<nav style="height:56px; display:flex; align-items:center; padding: 0 24px; background:rgba(15,15,15,0.95); position:sticky; top:0; z-index:10;">
    <span style="font-family:Syncopate; font-size:18px; color:var(--p);">KEYVI STUDIO</span>
</nav>

<div class="yt-grid" id="public-gallery">
    </div>

<div id="studio-overlay">
    <div class="studio-nav">
        <div style="font-weight:bold; color:var(--p);">CREATOR STUDIO</div>
        <div style="display:flex; gap:20px;">
            <button onclick="showUpload()" style="background:var(--p); border:none; padding:8px 16px; font-weight:bold; cursor:pointer; border-radius:2px;">CREATE</button>
            <button onclick="closeStudio()" style="background:#333; color:white; border:none; padding:8px 16px; cursor:pointer;">EXIT</button>
        </div>
    </div>

    <div class="studio-body">
        <div class="studio-sidebar">
            <div style="padding:10px 24px; color:var(--p); background:rgba(212,175,55,0.1); border-left:3px solid var(--p);">Content</div>
            <div style="padding:10px 24px; color:#aaa;">Analytics</div>
            <div style="padding:10px 24px; color:#aaa;">Customization</div>
        </div>
        
        <div class="studio-content" id="studio-list-view">
            <h2>Channel content</h2>
            <table style="width:100%; text-align:left; border-collapse: collapse;">
                <thead style="border-bottom:1px solid #333; color:#aaa; font-size:12px;">
                    <tr><th>VIDEO / TRACK</th><th>VISIBILITY</th><th>DATE</th></tr>
                </thead>
                <tbody id="studio-table-body"></tbody>
            </table>
        </div>
    </div>
</div>

<div id="upload-modal" style="position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:1000000; display:none; align-items:center;">
    <div class="upload-flow">
        <div class="flow-header">
            <span id="flow-title">Upload Content</span>
            <button onclick="document.getElementById('upload-modal').style.display='none'" style="background:none; border:none; color:white; cursor:pointer;">âœ•</button>
        </div>
        <div class="flow-body">
            <div class="flow-left">
                <h3>Details</h3>
                <div class="yt-input-wrap">
                    <label>Title (required)</label>
                    <input type="text" id="up-title" placeholder="Add a title that describes your content">
                </div>
                <div class="yt-input-wrap">
                    <label>Description</label>
                    <textarea id="up-desc" rows="4" placeholder="Tell viewers about your content"></textarea>
                </div>
                <h3>Thumbnail</h3>
                <p style="font-size:12px; color:#aaa;">Select or upload a picture that shows what's in your content.</p>
                <input type="file" id="up-img" accept="image/*">
                
                <h3 style="margin-top:30px;">Media File</h3>
                <input type="file" id="up-media" accept="audio/*,video/*">
            </div>
            <div class="flow-right">
                <div class="preview-pane">
                   <div style="height:100%; display:flex; align-items:center; justify-content:center; color:#444;">Video Preview</div>
                </div>
                <div style="margin-top:20px;">
                    <p style="font-size:12px; color:#aaa;">Visibility</p>
                    <select id="up-vis" style="width:100%; background:#1a1a1a; color:white; padding:10px; border:1px solid #444;">
                        <option value="public">Public</option>
                        <option value="private">Private (Admin only)</option>
                    </select>
                </div>
                <button onclick="startUpload()" style="width:100%; margin-top:40px; background:#3ea6ff; color:black; border:none; padding:12px; font-weight:bold; cursor:pointer; border-radius:2px;">PUBLISH</button>
                <div id="up-progress" style="margin-top:10px; font-size:12px; color:var(--p);"></div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDIl8kUa8mGmdRT1iqCmFtoR11gu8HkU0o",
        authDomain: "keyviproductions-370d7.firebaseapp.com",
        projectId: "keyviproductions-370d7",
        storageBucket: "keyviproductions-370d7.firebasestorage.app",
        messagingSenderId: "250302202778",
        appId: "1:250302202778:web:4570c3ca39df015986b023"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- NAVIGATION ---
    window.openStudio = () => { 
        const pass = prompt("Enter Studio Passcode:");
        if(pass === '174539') document.getElementById('studio-overlay').style.display='flex'; 
    };
    window.closeStudio = () => document.getElementById('studio-overlay').style.display='none';
    window.showUpload = () => document.getElementById('upload-modal').style.display='flex';

    // --- UPLOAD PROCESS ---
    window.startUpload = async () => {
        const title = document.getElementById('up-title').value;
        const desc = document.getElementById('up-desc').value;
        const mediaFile = document.getElementById('up-media').files[0];
        const thumbFile = document.getElementById('up-img').files[0];
        const vis = document.getElementById('up-vis').value;
        const prog = document.getElementById('up-progress');

        if(!title || !mediaFile) return alert("Title and Media File are required.");

        prog.innerText = "Step 1: Uploading Media...";
        const mRef = ref(storage, `content/${Date.now()}_${mediaFile.name}`);
        await uploadBytes(mRef, mediaFile);
        const mUrl = await getDownloadURL(mRef);

        prog.innerText = "Step 2: Uploading Thumbnail...";
        let tUrl = "https://images.unsplash.com/photo-1520523839897-bd0b52f945a0?w=800";
        if(thumbFile) {
            const tRef = ref(storage, `thumbs/${Date.now()}`);
            await uploadBytes(tRef, thumbFile);
            tUrl = await getDownloadURL(tRef);
        }

        prog.innerText = "Step 3: Finalizing Checks...";
        await addDoc(collection(db, "yt_studio_v1"), {
            title, desc, media: mUrl, thumb: tUrl, visibility: vis, date: new Date().toLocaleDateString(), timestamp: Date.now()
        });

        prog.innerText = "Upload Complete!";
        setTimeout(() => {
            document.getElementById('upload-modal').style.display='none';
            prog.innerText = "";
        }, 1500);
    };

    // --- DATA SYNC ---
    onSnapshot(query(collection(db, "yt_studio_v1"), orderBy("timestamp", "desc")), (snap) => {
        const gallery = document.getElementById('public-gallery');
        const table = document.getElementById('studio-table-body');
        gallery.innerHTML = "";
        table.innerHTML = "";

        snap.forEach(d => {
            const item = d.data();
            
            // Public Gallery
            if(item.visibility === 'public') {
                gallery.innerHTML += `
                    <div class="yt-card">
                        <img src="${item.thumb}" class="yt-thumb">
                        <div class="yt-info">
                            <div class="yt-avatar"></div>
                            <div>
                                <div style="font-weight:bold;">${item.title}</div>
                                <div style="font-size:12px; color:#aaa; margin-top:4px;">Keyvi Productions</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Studio Table
            table.innerHTML += `
                <tr style="border-bottom:1px solid #222;">
                    <td style="padding:15px; display:flex; gap:10px; align-items:center;">
                        <img src="${item.thumb}" style="width:100px; border-radius:4px;">
                        <div>
                            <div style="font-size:14px;">${item.title}</div>
                            <div style="font-size:11px; color:#666;">${item.desc.substring(0,30)}...</div>
                        </div>
                    </td>
                    <td style="color:${item.visibility === 'public' ? '#27c93f' : '#aaa'}">${item.visibility}</td>
                    <td style="font-size:12px; color:#aaa;">${item.date} <br> <button onclick="deleteDoc(doc(db, 'yt_studio_v1', '${d.id}'))" style="background:none; border:none; color:red; cursor:pointer; font-size:10px;">Delete</button></td>
                </tr>
            `;
        });
    });
</script>
</body>
</html>